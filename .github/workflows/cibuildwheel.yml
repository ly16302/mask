name: cibuildwheel

on:
  push:
    paths: #Condition to go ahead
      - "**.py"
      - "**.f90"
      - "**.f"
      - .github/workflows/cibuildwheel.yml

jobs:
  
  tests:
    name: Test build on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
        fortran-compiler: [gfortran-9] # Version of GFortran we want to use.
        python_version: ['3.8']
    env:
      FC: ${{ matrix.fortran-compiler }}
      
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      # Used to host cibuildwheel
      - name: Set up Python
        uses: actions/setup-python@v2
        with: 
          python-version: ${{ matrix.python_version }}    

      - name: Set up numpy
        run: python -m pip install numpy
    
      - name: Install GFortran Linux
        if: contains(matrix.os, 'ubuntu')
        run: sudo apt-get install ${{matrix.fortran-compiler}}
          
      - name: Install GFortran macOS
        if: contains(matrix.os, 'macos')
        run: brew install gcc@9
    
      - name: Build
        run: f2py -c mask_interpolation.o -m mask_interpolation --fcompiler=${{matrix.fortran-compiler}} --f90flags='-fopenmp' -lgomp
        
